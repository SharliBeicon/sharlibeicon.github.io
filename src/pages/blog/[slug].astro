---
import Layout from "../../layouts/Layout.astro";
import { getCollection, type CollectionEntry } from "astro:content";

export async function getStaticPaths() {
  const posts = await getCollection("blog");
  return posts.map((post: CollectionEntry<"blog">) => ({
    params: { slug: post.slug },
    props: post,
  }));
}

type Props = CollectionEntry<"blog">;

const post = Astro.props;
const { Content } = await post.render();

function formatDate(date: Date) {
  return date.toLocaleDateString("en-US", {
    year: "numeric",
    month: "long",
    day: "numeric",
  });
}
---

<Layout>
  <div
    class="min-h-screen bg-[var(--background0)] text-[var(--fg0)] flex flex-col"
  >
    <!-- Header -->
    <header
      class="bg-[var(--background1)] border-b border-[var(--border-color)]"
    >
      <div class="max-w-4xl mx-auto px-6 py-6">
        <nav class="mb-4">
          <a
            href="/blog"
            class="inline-flex items-center text-[var(--blue)] hover:text-[var(--cyan)] transition-colors duration-200 text-sm"
          >
            <svg
              class="w-4 h-4 mr-2"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M15 19l-7-7 7-7"></path>
            </svg>
            Back to Blog
          </a>
        </nav>

        <div class="flex items-center justify-between mb-3">
          <time class="text-sm text-[var(--fg1)]">
            {formatDate(post.data.pubDate)}
          </time>
          {
            post.data.tags && post.data.tags.length > 0 && (
              <div class="flex flex-wrap gap-2">
                {post.data.tags.map((tag: string) => (
                  <span class="text-xs text-[var(--blue)] bg-[var(--blue)]/10 px-2 py-1 rounded-full">
                    #{tag}
                  </span>
                ))}
              </div>
            )
          }
        </div>

        <h1 class="text-2xl font-bold mb-2 leading-tight">
          {post.data.title}
        </h1>

        <p class="text-[var(--fg1)] leading-relaxed">
          {post.data.description}
        </p>
      </div>
    </header>

    <!-- Blog Content -->
    <main class="max-w-4xl mx-auto px-6 py-4 flex-grow">
      <article class="max-w-none">
        <div class="blog-content text-[var(--fg0)]">
          <Content />
        </div>
      </article>
    </main>

    <!-- Footer -->
    <footer
      class="border-t border-[var(--border-color)] bg-[var(--background1)] mt-auto"
    >
      <div class="max-w-4xl mx-auto px-6 py-8">
        <div
          class="flex justify-between items-center text-sm text-[var(--fg1)]"
        >
          <span class="opacity-80">Â© 2025 Charlie Bacon</span>
          <div class="flex gap-4">
            <a
              href="/blog"
              class="text-[var(--fg1)] hover:text-[var(--fg0)] transition-colors duration-200"
            >
              More posts
            </a>
            <a
              href="/"
              class="text-[var(--fg1)] hover:text-[var(--fg0)] transition-colors duration-200"
            >
              Home
            </a>
          </div>
        </div>
      </div>
    </footer>
  </div>

  <style>
    /* Blog content styling */
    .blog-content {
      line-height: 1.5;
      color: var(--fg0);
    }

    .blog-content :global(h1) {
      color: var(--fg0);
      font-size: 1.875rem;
      font-weight: 700;
      margin: 1.5rem 0 0.75rem 0;
      border-bottom: 2px solid var(--border-color);
      padding-bottom: 0.5rem;
    }

    .blog-content :global(h2) {
      color: var(--fg0);
      font-size: 1.5rem;
      font-weight: 600;
      margin: 1.25rem 0 0.5rem 0;
    }

    .blog-content :global(h3) {
      color: var(--fg0);
      font-size: 1.25rem;
      font-weight: 600;
      margin: 1rem 0 0.25rem 0;
    }

    .blog-content :global(h4),
    .blog-content :global(h5),
    .blog-content :global(h6) {
      color: var(--fg0);
      font-weight: 600;
      margin: 0.75rem 0 0.25rem 0;
    }

    .blog-content :global(p) {
      margin: 0.75rem 0;
      color: var(--fg0);
    }

    .blog-content :global(ul),
    .blog-content :global(ol) {
      margin: 1rem 0;
      padding-left: 1.5rem;
    }

    .blog-content :global(li) {
      margin: 0.5rem 0;
      color: var(--fg0);
    }

    .blog-content :global(strong) {
      color: var(--blue);
      font-weight: 600;
    }

    .blog-content :global(em) {
      color: var(--cyan);
      font-style: italic;
    }

    .blog-content :global(code) {
      background: var(--background2);
      color: var(--yellow);
      padding: 0.125rem 0.375rem;
      border-radius: 0.25rem;
      font-size: 0.875em;
      font-family: var(--font-family);
    }

    .blog-content :global(pre) {
      background: var(--background2);
      border: 1px solid var(--border-color);
      border-radius: 0.5rem;
      padding: 1rem;
      overflow-x: auto;
      margin: 1.5rem 0;
    }

    .blog-content :global(pre code) {
      background: transparent;
      padding: 0;
      color: var(--fg0);
      font-size: 0.875rem;
    }

    .blog-content :global(blockquote) {
      border-left: 3px solid var(--blue);
      padding-left: 1rem;
      margin: 1.5rem 0;
      color: var(--fg1);
      font-style: italic;
      background: var(--background1);
      padding: 1rem;
      border-radius: 0.25rem;
    }

    .blog-content :global(a) {
      color: var(--blue);
      text-decoration: underline;
      text-decoration-color: var(--blue);
      text-underline-offset: 2px;
      transition: color 0.2s ease;
    }

    .blog-content :global(a:hover) {
      color: var(--cyan);
      text-decoration-color: var(--cyan);
    }

    .blog-content :global(hr) {
      border: none;
      border-top: 1px solid var(--border-color);
      margin: 2rem 0;
    }

    .blog-content :global(table) {
      width: 100%;
      border-collapse: collapse;
      margin: 1.5rem 0;
    }

    .blog-content :global(th),
    .blog-content :global(td) {
      border: 1px solid var(--border-color);
      padding: 0.5rem;
      text-align: left;
    }

    .blog-content :global(th) {
      background: var(--background1);
      font-weight: 600;
    }

    .blog-content :global(img) {
      max-width: 100%;
      height: auto;
      border-radius: 0.5rem;
      margin: 1rem 0;
    }
  </style>
</Layout>

